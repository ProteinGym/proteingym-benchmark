schema: '2.0'
stages:
  create_training_job@dataset0-model0:
    cmd:
    - docker build --build-arg GIT_CACHE_BUST=1 --secret id=git_auth,src=../git-auth.txt
      -f ../../../models/pls/Dockerfile -t pls:latest ../../..
    - docker run --rm -v $(realpath ../../../datasets):/datasets -v $(realpath ../../../models):/models
      -v $(realpath output):/opt/ml/model pls:latest train --dataset-file /datasets/dummy/dataset.zip
      --model-card-file /models/pls/README.md
    - docker image prune -a -f
    deps:
    - path: ../../../datasets/dummy/dataset.zip
      hash: md5
      md5: 6efa993ab1d169974759032feae3f93c
      size: 33985
    - path: ../../../models/pls/Dockerfile
      hash: md5
      md5: 901a42e51cf4a14665099985ee9c30de
      size: 1138
    - path: ../../../models/pls/README.md
      hash: md5
      md5: 9fad88f2cb03369789d7143c7ee4844b
      size: 837
    - path: logs/setup.txt
      hash: md5
      md5: c861b0c201d5e28492f5dff8fab634f5
      size: 26
    outs:
    - path: output/charge_ladder_pls.csv
      hash: md5
      md5: 2331ac53475416456e701ecdf6ee51b5
      size: 13780
  create_training_job@dataset1-model0:
    cmd:
    - docker build --build-arg GIT_CACHE_BUST=1 --secret id=git_auth,src=../git-auth.txt
      -f ../../../models/pls/Dockerfile -t pls:latest ../../..
    - docker run --rm -v $(realpath ../../../datasets):/datasets -v $(realpath ../../../models):/models
      -v $(realpath output):/opt/ml/model pls:latest train --dataset-file /datasets/neime/dataset.zip
      --model-card-file /models/pls/README.md
    - docker image prune -a -f
    deps:
    - path: ../../../datasets/neime/dataset.zip
      hash: md5
      md5: 45524cd511a606635ea0ba0b84ce7b55
      size: 8375
    - path: ../../../models/pls/Dockerfile
      hash: md5
      md5: 901a42e51cf4a14665099985ee9c30de
      size: 1138
    - path: ../../../models/pls/README.md
      hash: md5
      md5: 9fad88f2cb03369789d7143c7ee4844b
      size: 837
    - path: logs/setup.txt
      hash: md5
      md5: c861b0c201d5e28492f5dff8fab634f5
      size: 26
    outs:
    - path: output/neime_pls.csv
      hash: md5
      md5: 0ba5399bd48be7053fd80f12065daf08
      size: 35028
  calculate_metric@dataset0-model0:
    cmd: uv run pg2-benchmark metric calc --output-path output/charge_ladder_pls.csv
      --metric-path metric/charge_ladder_pls.csv
    deps:
    - path: output/charge_ladder_pls.csv
      hash: md5
      md5: 2331ac53475416456e701ecdf6ee51b5
      size: 13780
    outs:
    - path: metric/charge_ladder_pls.csv
      hash: md5
      md5: 566553f3fe5f4eca170de4a58d60e007
      size: 1457
  calculate_metric@dataset1-model0:
    cmd: uv run pg2-benchmark metric calc --output-path output/neime_pls.csv --metric-path
      metric/neime_pls.csv
    deps:
    - path: output/neime_pls.csv
      hash: md5
      md5: 0ba5399bd48be7053fd80f12065daf08
      size: 35028
    outs:
    - path: metric/neime_pls.csv
      hash: md5
      md5: 64464e0f19baeb76e4921e583a991427
      size: 1623
  setup:
    cmd:
    - mkdir -p logs output metric
    - echo "Created local directories" > logs/setup.txt
    outs:
    - path: logs/setup.txt
      hash: md5
      md5: c861b0c201d5e28492f5dff8fab634f5
      size: 26
