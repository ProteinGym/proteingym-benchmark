schema: '2.0'
stages:
  setup:
    cmd:
    - mkdir -p logs prediction metric
    - echo "Created local directories" > logs/setup.txt
    outs:
    - path: logs/setup.txt
      hash: md5
      md5: c861b0c201d5e28492f5dff8fab634f5
      size: 26
  create_training_job@dataset0-model0:
    cmd:
    - docker build  -f $(dirname 
      /home/runner/work/proteingym-benchmark/proteingym-benchmark/models/esm/README.md)/Dockerfile
      -t esm:latest $(dirname 
      /home/runner/work/proteingym-benchmark/proteingym-benchmark/models/esm/README.md)
    - docker run --rm -v $(realpath 
      /home/runner/work/proteingym-benchmark/proteingym-benchmark/datasets/ranganathan.pgdata):/$(basename
      /home/runner/work/proteingym-benchmark/proteingym-benchmark/datasets/ranganathan.pgdata)
      -v $(realpath 
      /home/runner/work/proteingym-benchmark/proteingym-benchmark/models/esm/README.md):/$(basename
      /home/runner/work/proteingym-benchmark/proteingym-benchmark/models/esm/README.md)
      -v $(realpath prediction):/opt/program/output esm:latest train 
      --dataset-file /$(basename 
      /home/runner/work/proteingym-benchmark/proteingym-benchmark/datasets/ranganathan.pgdata)
      --model-card-file /$(basename 
      /home/runner/work/proteingym-benchmark/proteingym-benchmark/models/esm/README.md)
    - docker image prune -a -f
    deps:
    - path: ../../datasets/ranganathan.pgdata
      hash: md5
      md5: 705ae59ddb902d5874ac418556bd9955
      size: 90838
    - path: ../../models/esm/README.md
      hash: md5
      md5: 835013150947613f296c1ebd5cb013a6
      size: 2131
    - path: logs/setup.txt
      hash: md5
      md5: c861b0c201d5e28492f5dff8fab634f5
      size: 26
    outs:
    - path: prediction/ranganathan_esm.csv
      hash: md5
      md5: b564ad013a83ee41027cb89fb038d3e8
      size: 185963
  calculate_metric@dataset0-model0:
    cmd: METRICS=$(python -c "import yaml; data = 
      yaml.safe_load(open('default.yaml')); print(' '.join(data['metrics']))") 
      && python $(dvc root)/scripts/metric.py --prediction-path 
      prediction/ranganathan_esm.csv --metric-path metric/ranganathan_esm.json 
      --selected-metrics $METRICS
    deps:
    - path: prediction/ranganathan_esm.csv
      hash: md5
      md5: b564ad013a83ee41027cb89fb038d3e8
      size: 185963
    outs:
    - path: metric/ranganathan_esm.json
      hash: md5
      md5: 602b917e826a6ec7b27b4cf2cffe4d5c
      size: 38
