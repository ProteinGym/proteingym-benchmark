schema: '2.0'
stages:
  supervised_predict@dataset0-model0:
    cmd: uv run pg2-benchmark model predict --dataset-manifest data/dummy/charge_ladder.toml
      --model-manifest model/pls.toml --model-dockerfile-folder ../models/pls --model-name
      pls
    deps:
    - path: ../models/pls
      hash: md5
      md5: b344899594d54b6493151eca1b7a55cc.dir
      size: 545913774
      nfiles: 17727
    - path: ../src/pg2_benchmark/cli/model.py
      hash: md5
      md5: 7b69bd48d88f96c7e759334208c24226
      size: 1687
    - path: data/dummy/charge_ladder.toml
      hash: md5
      md5: 4c4119e8f92050f97396da01c5ba5fba
      size: 248
    - path: model/pls.toml
      hash: md5
      md5: 751569f65bbbc4d796ddc02a70dce809
      size: 185
    outs:
    - path: output/charge_ladder_pls.csv
      hash: md5
      md5: 5f067b476869f7742deceb58d82b219e
      size: 13805
  supervised_predict@dataset1-model0:
    cmd: uv run pg2-benchmark model predict --dataset-manifest data/neime/neime.toml
      --model-manifest model/pls.toml --model-dockerfile-folder ../models/pls --model-name
      pls
    deps:
    - path: ../models/pls
      hash: md5
      md5: b344899594d54b6493151eca1b7a55cc.dir
      size: 545913774
      nfiles: 17727
    - path: ../src/pg2_benchmark/cli/model.py
      hash: md5
      md5: 7b69bd48d88f96c7e759334208c24226
      size: 1687
    - path: data/neime/neime.toml
      hash: md5
      md5: 394178d3ffeda14fdad7a77c88d4c831
      size: 266
    - path: model/pls.toml
      hash: md5
      md5: 751569f65bbbc4d796ddc02a70dce809
      size: 185
    outs:
    - path: output/neime_pls.csv
      hash: md5
      md5: 6a5f0421990b0cd46074054fd2a803fc
      size: 35085
  supervised_metric@dataset0-model0:
    cmd: uv run pg2-benchmark metric calc --output-path output/charge_ladder_pls.csv
      --metric-path metric/charge_ladder_pls.csv
    deps:
    - path: ../src/pg2_benchmark/cli/metric.py
      hash: md5
      md5: 2f2a5d08badb89c5d507fa9e2e5bbe2d
      size: 774
    - path: output/charge_ladder_pls.csv
      hash: md5
      md5: 5f067b476869f7742deceb58d82b219e
      size: 13805
    outs:
    - path: metric/charge_ladder_pls.csv
      hash: md5
      md5: b7b16f18e4d001b6070412b5466b7dc9
      size: 1456
  supervised_metric@dataset1-model0:
    cmd: uv run pg2-benchmark metric calc --output-path output/neime_pls.csv --metric-path
      metric/neime_pls.csv
    deps:
    - path: ../src/pg2_benchmark/cli/metric.py
      hash: md5
      md5: 2f2a5d08badb89c5d507fa9e2e5bbe2d
      size: 774
    - path: output/neime_pls.csv
      hash: md5
      md5: 6a5f0421990b0cd46074054fd2a803fc
      size: 35085
    outs:
    - path: metric/neime_pls.csv
      hash: md5
      md5: a92f7c0b6a9d4199edf4fc33812129dc
      size: 1619
  predict@dataset0-model0:
    cmd: uv run pg2-benchmark model predict --type supervised --dataset-manifest ../datasets/dummy/charge_ladder.toml
      --model-manifest ../models/pls/pls.toml --model-dockerfile-folder ../models/pls
      --model-name pls
    deps:
    - path: ../datasets/dummy/charge_ladder.toml
      hash: md5
      md5: 0ac8a36fd5384cae016926f82c82d8a9
      size: 254
    - path: ../models/pls
      hash: md5
      md5: fd3c48e3ccb7ab3152d2c50e1204bc8a.dir
      size: 545913959
      nfiles: 17728
    - path: ../models/pls/pls.toml
      hash: md5
      md5: 751569f65bbbc4d796ddc02a70dce809
      size: 185
    - path: ../src/pg2_benchmark/cli/model.py
      hash: md5
      md5: 5a9ca1b8490290e72ff87b8ac0cb42c6
      size: 1818
    outs:
    - path: output/charge_ladder_pls.csv
      hash: md5
      md5: 9458c189d156ee6bf1859f72a50dfda6
      size: 13754
  predict@dataset1-model0:
    cmd: uv run pg2-benchmark model predict --type supervised --dataset-manifest ../datasets/neime/neime.toml
      --model-manifest ../models/pls/pls.toml --model-dockerfile-folder ../models/pls
      --model-name pls
    deps:
    - path: ../datasets/neime/neime.toml
      hash: md5
      md5: b3cc878ed9f51abf478bfcd63af0bc0c
      size: 272
    - path: ../models/pls
      hash: md5
      md5: fd3c48e3ccb7ab3152d2c50e1204bc8a.dir
      size: 545913959
      nfiles: 17728
    - path: ../models/pls/pls.toml
      hash: md5
      md5: 751569f65bbbc4d796ddc02a70dce809
      size: 185
    - path: ../src/pg2_benchmark/cli/model.py
      hash: md5
      md5: 5a9ca1b8490290e72ff87b8ac0cb42c6
      size: 1818
    outs:
    - path: output/neime_pls.csv
      hash: md5
      md5: a2a050e899526619f1e3e845aba57eab
      size: 34937
  calc_metric@dataset0-model0:
    cmd: uv run pg2-benchmark metric calc --output-path output/charge_ladder_pls.csv
      --metric-path metric/charge_ladder_pls.csv
    deps:
    - path: ../src/pg2_benchmark/cli/metric.py
      hash: md5
      md5: 2f2a5d08badb89c5d507fa9e2e5bbe2d
      size: 774
    - path: output/charge_ladder_pls.csv
      hash: md5
      md5: 9458c189d156ee6bf1859f72a50dfda6
      size: 13754
    outs:
    - path: metric/charge_ladder_pls.csv
      hash: md5
      md5: 63e9f5c5804aaa678c15c4286745a5a9
      size: 1457
  calc_metric@dataset1-model0:
    cmd: uv run pg2-benchmark metric calc --output-path output/neime_pls.csv --metric-path
      metric/neime_pls.csv
    deps:
    - path: ../src/pg2_benchmark/cli/metric.py
      hash: md5
      md5: 2f2a5d08badb89c5d507fa9e2e5bbe2d
      size: 774
    - path: output/neime_pls.csv
      hash: md5
      md5: a2a050e899526619f1e3e845aba57eab
      size: 34937
    outs:
    - path: metric/neime_pls.csv
      hash: md5
      md5: 5f56ad9b26b9a027ccaa7ee9b00549e8
      size: 1619
  create_training_job@dataset0-model0:
    cmd:
    - docker build --no-cache --secret id=git_auth,src=git-auth.txt -f ../models/pls/Dockerfile
      -t pls:latest ..
    - docker run --rm -v $(realpath ../datasets):/datasets -v $(realpath ../models):/models
      -v $(realpath output/local):/output pls:latest train --dataset-toml-file /datasets/dummy/charge_ladder.toml
      --model-toml-file /models/pls/manifest.toml
    - docker image prune -a -f
    deps:
    - path: ../datasets/dummy/charge_ladder.toml
      hash: md5
      md5: bcd140fc3152f1fcc9906f1a0667846d
      size: 258
    - path: ../models/pls/Dockerfile
      hash: md5
      md5: 901a42e51cf4a14665099985ee9c30de
      size: 1138
    - path: ../models/pls/manifest.toml
      hash: md5
      md5: 751569f65bbbc4d796ddc02a70dce809
      size: 185
    outs:
    - path: output/local/charge_ladder_pls.csv
      hash: md5
      md5: 2a2145f0345bf340c208c6dcc3bf2863
      size: 13780
  create_training_job@dataset1-model0:
    cmd:
    - docker build --no-cache --secret id=git_auth,src=git-auth.txt -f ../models/pls/Dockerfile
      -t pls:latest ..
    - docker run --rm -v $(realpath ../datasets):/datasets -v $(realpath ../models):/models
      -v $(realpath output/local):/output pls:latest train --dataset-toml-file /datasets/neime/neime.toml
      --model-toml-file /models/pls/manifest.toml
    - docker image prune -a -f
    deps:
    - path: ../datasets/neime/neime.toml
      hash: md5
      md5: 894acf89b5058d6e50c454ddc53dd326
      size: 276
    - path: ../models/pls/Dockerfile
      hash: md5
      md5: 901a42e51cf4a14665099985ee9c30de
      size: 1138
    - path: ../models/pls/manifest.toml
      hash: md5
      md5: 751569f65bbbc4d796ddc02a70dce809
      size: 185
    outs:
    - path: output/local/neime_pls.csv
      hash: md5
      md5: 4ac1900a997dcf92c86ff082c5525a29
      size: 35019
  calculate_metric@dataset0-model0:
    cmd: uv run pg2-benchmark metric calc --output-path output/local/charge_ladder_pls.csv
      --metric-path metric/local/charge_ladder_pls.csv
    deps:
    - path: output/local/charge_ladder_pls.csv
      hash: md5
      md5: 2a2145f0345bf340c208c6dcc3bf2863
      size: 13780
    outs:
    - path: metric/local/charge_ladder_pls.csv
      hash: md5
      md5: d2e9585da62ad366468746533536fa83
      size: 1457
  calculate_metric@dataset1-model0:
    cmd: uv run pg2-benchmark metric calc --output-path output/local/neime_pls.csv
      --metric-path metric/local/neime_pls.csv
    deps:
    - path: output/local/neime_pls.csv
      hash: md5
      md5: 4ac1900a997dcf92c86ff082c5525a29
      size: 35019
    outs:
    - path: metric/local/neime_pls.csv
      hash: md5
      md5: 71acb4373ff1e2e9ec3cab577615189f
      size: 1624
