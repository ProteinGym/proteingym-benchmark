schema: '2.0'
stages:
  create_training_job@dataset0-model0:
    cmd:
    - docker build --build-arg GIT_CACHE_BUST=1 --secret id=git_auth,src=../git-auth.txt
      -f ../../models/pls/Dockerfile -t pls:latest ../..
    - docker run --rm -v $(realpath ../../datasets):/datasets -v $(realpath ../../models):/models
      -v $(realpath output):/opt/ml/model pls:latest train --dataset-file /datasets/dummy/dataset.zip
      --model-toml-file /models/pls/manifest.toml
    - docker image prune -a -f
    deps:
    - path: ../../datasets/dummy/dataset.zip
      hash: md5
      md5: 6efa993ab1d169974759032feae3f93c
      size: 33985
    - path: ../../models/pls/Dockerfile
      hash: md5
      md5: 901a42e51cf4a14665099985ee9c30de
      size: 1138
    - path: ../../models/pls/manifest.toml
      hash: md5
      md5: 751569f65bbbc4d796ddc02a70dce809
      size: 185
    outs:
    - path: output/charge_ladder_pls.csv
      hash: md5
      md5: 732b6e1ee3025435fede2be649446cab
      size: 13785
  create_training_job@dataset1-model0:
    cmd:
    - docker build --build-arg GIT_CACHE_BUST=1 --secret id=git_auth,src=../git-auth.txt
      -f ../../models/pls/Dockerfile -t pls:latest ../..
    - docker run --rm -v $(realpath ../../datasets):/datasets -v $(realpath ../../models):/models
      -v $(realpath output):/opt/ml/model pls:latest train --dataset-file /datasets/neime/dataset.zip
      --model-toml-file /models/pls/manifest.toml
    - docker image prune -a -f
    deps:
    - path: ../../datasets/neime/dataset.zip
      hash: md5
      md5: 45524cd511a606635ea0ba0b84ce7b55
      size: 8375
    - path: ../../models/pls/Dockerfile
      hash: md5
      md5: 901a42e51cf4a14665099985ee9c30de
      size: 1138
    - path: ../../models/pls/manifest.toml
      hash: md5
      md5: 751569f65bbbc4d796ddc02a70dce809
      size: 185
    outs:
    - path: output/neime_pls.csv
      hash: md5
      md5: a384ae8ac38e45f75dbd15a278e108c6
      size: 35005
  calculate_metric@dataset0-model0:
    cmd: uv run pg2-benchmark metric calc --output-path output/charge_ladder_pls.csv
      --metric-path metric/charge_ladder_pls.csv
    deps:
    - path: output/charge_ladder_pls.csv
      hash: md5
      md5: 732b6e1ee3025435fede2be649446cab
      size: 13785
    outs:
    - path: metric/charge_ladder_pls.csv
      hash: md5
      md5: f9ca9305d59e0729e0e1347e26bc0cb8
      size: 1457
  calculate_metric@dataset1-model0:
    cmd: uv run pg2-benchmark metric calc --output-path output/neime_pls.csv --metric-path
      metric/neime_pls.csv
    deps:
    - path: output/neime_pls.csv
      hash: md5
      md5: a384ae8ac38e45f75dbd15a278e108c6
      size: 35005
    outs:
    - path: metric/neime_pls.csv
      hash: md5
      md5: 2a4a188eb4253e0752b32ce286862d35
      size: 1569
