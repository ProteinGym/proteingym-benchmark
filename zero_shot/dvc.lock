schema: '2.0'
stages:
  zero_shot_predict@dataset0-model0:
    cmd: uv run pg2-benchmark model predict --dataset-manifest data/ranganathan/ranganathan.toml
      --model-manifest model/esm.toml --model-dockerfile-folder ../models/esm --model-name
      esm
    deps:
    - path: ../models/esm
      hash: md5
      md5: 72affc31a799609278cf98508f95be9f.dir
      size: 831070514
      nfiles: 30600
    - path: ../src/pg2_benchmark/cli/model.py
      hash: md5
      md5: 7b69bd48d88f96c7e759334208c24226
      size: 1687
    - path: data/ranganathan/ranganathan.toml
      hash: md5
      md5: ec8bc8dfa7b6415a9b70a417994e306d
      size: 986
    - path: model/esm.toml
      hash: md5
      md5: 64b3f9c9ca8ca6553bc695a1fba4d974
      size: 111
    outs:
    - path: output/ranganathan_esm.csv
      hash: md5
      md5: 39b2dea9bd44e696936e6b3e4f1a4a4c
      size: 195883
  zero_shot_metric@dataset0-model0:
    cmd: uv run pg2-benchmark metric calc --output-path output/ranganathan_esm.csv
      --metric-path metric/ranganathan_esm.csv
    deps:
    - path: ../src/pg2_benchmark/cli/metric.py
      hash: md5
      md5: 2f2a5d08badb89c5d507fa9e2e5bbe2d
      size: 774
    - path: output/ranganathan_esm.csv
      hash: md5
      md5: 39b2dea9bd44e696936e6b3e4f1a4a4c
      size: 195883
    outs:
    - path: metric/ranganathan_esm.csv
      hash: md5
      md5: f38bb057ff25591c67c5985a58af8d1f
      size: 1588
  predict@dataset0-model0:
    cmd: uv run pg2-benchmark model predict --type zero_shot --dataset-manifest ../datasets/ranganathan/ranganathan.toml
      --model-manifest ../models/esm/esm.toml --model-dockerfile-folder ../models/esm
      --model-name esm
    deps:
    - path: ../datasets/ranganathan/ranganathan.toml
      hash: md5
      md5: 33d54ccb8c88dedf8f11f37a45a99d60
      size: 999
    - path: ../models/esm
      hash: md5
      md5: ce6c810186fdcf8c7307c14b47370446.dir
      size: 831070625
      nfiles: 30601
    - path: ../models/esm/esm.toml
      hash: md5
      md5: 64b3f9c9ca8ca6553bc695a1fba4d974
      size: 111
    - path: ../src/pg2_benchmark/cli/model.py
      hash: md5
      md5: 5a9ca1b8490290e72ff87b8ac0cb42c6
      size: 1818
    outs:
    - path: output/ranganathan_esm.csv
      hash: md5
      md5: 39b2dea9bd44e696936e6b3e4f1a4a4c
      size: 195883
  calc_metric@dataset0-model0:
    cmd: uv run pg2-benchmark metric calc --output-path output/ranganathan_esm.csv
      --metric-path metric/ranganathan_esm.csv
    deps:
    - path: ../src/pg2_benchmark/cli/metric.py
      hash: md5
      md5: 2f2a5d08badb89c5d507fa9e2e5bbe2d
      size: 774
    - path: output/ranganathan_esm.csv
      hash: md5
      md5: 39b2dea9bd44e696936e6b3e4f1a4a4c
      size: 195883
    outs:
    - path: metric/ranganathan_esm.csv
      hash: md5
      md5: 4969ac651d461ac62496caf718afadfa
      size: 1588
  create_training_job@dataset0-model0:
    cmd:
    - docker build --build-arg GIT_CACHE_BUST=1 --secret id=git_auth,src=git-auth.txt
      -f ../models/esm/Dockerfile -t esm:latest ..
    - docker run --rm -v $(realpath ../datasets):/datasets -v $(realpath ../models):/models
      -v $(realpath output/local):/opt/ml/model esm:latest train --dataset-file /datasets/ranganathan/dataset.zip
      --model-toml-file /models/esm/manifest.toml
    - docker image prune -a -f
    deps:
    - path: ../datasets/ranganathan/dataset.zip
      hash: md5
      md5: b7c8410bc7d34c92e8d11d8b0064fbc7
      size: 39040
    - path: ../models/esm/Dockerfile
      hash: md5
      md5: 7f13567daf55f157ab05f23602a1f53e
      size: 1138
    - path: ../models/esm/manifest.toml
      hash: md5
      md5: a8939829e644ac1b53b66a4fe6bd149e
      size: 125
    outs:
    - path: output/local/ranganathan_esm.csv
      hash: md5
      md5: 39b2dea9bd44e696936e6b3e4f1a4a4c
      size: 195883
  calculate_metric@dataset0-model0:
    cmd: uv run pg2-benchmark metric calc --output-path output/local/ranganathan_esm.csv
      --metric-path metric/local/ranganathan_esm.csv
    deps:
    - path: output/local/ranganathan_esm.csv
      hash: md5
      md5: 39b2dea9bd44e696936e6b3e4f1a4a4c
      size: 195883
    outs:
    - path: metric/local/ranganathan_esm.csv
      hash: md5
      md5: f38bb057ff25591c67c5985a58af8d1f
      size: 1588
